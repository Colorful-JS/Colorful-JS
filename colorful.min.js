(function(a,b,c){function g(b,c){this.element=b;this.options=a.extend({},e,c);this.methods=f;this._defaults=e;this._name=d;this.init()}var d="colorful",e={mapDataTo:["h"],elementSelector:"td",preventionSelector:null,attributeToColor:"background",dataAttribute:"html",hue:0,theta:220,portion:.25,offset:0,colorModel:"hsla",colors:null,saturation:70,lightness:50,alpha:1,reverse:false,stepwise:false,steps:10,scale:"linear",min_val:null,max_val:null,addedClass:"js-colorful"};var f={get_number_from_element:function(b,c){switch(c){case"html":return parseFloat(a(b).html());break;default:return parseFloat(a(b).attr(c));break}},scale_feature:function(a,b,c,d){var e=null;switch(a){case"linear":return d-c==0?0:(b-c)/(d-c);break;case"log":b=b==0?0:Math.log(b);c=c==0?0:Math.log(c);d=d==0?0:Math.log(d);return d-c==0?0:(b-c)/(d-c);break}},get_stepwise_value:function(a,b){var c,d;c=1/b;d=Math.floor(a/c);if(d==b){d--}return c*d},get_shade:function(a,b){return Math.round(a*b)},hslToRgb:function(a,b,c){var d,e,g;a/=360;b/=100;c/=100;if(b==0){d=e=g=c}else{var h=c<.5?c*(1+b):c+b-c*b;var i=2*c-h;d=f.hue2rgb(i,h,a+1/3);e=f.hue2rgb(i,h,a);g=f.hue2rgb(i,h,a-1/3)}return[d*255,e*255,g*255]},hue2rgb:function(a,b,c){if(c<0)c+=1;if(c>1)c-=1;if(c<1/6)return a+(b-a)*6*c;if(c<1/2)return b;if(c<2/3)return a+(b-a)*(2/3-c)*6;return a}};g.prototype.init=function(){this.max=0;this.min=Infinity;this.values=new Array;if(this.options.colors){this.options.stepwise=true;this.options.steps=this.options.colors.length}if(this.options.stepwise&&this.options.colorModel!="grayscale"){this.possible_hues=new Array;this.possible_sats=new Array;this.possible_lights=new Array;this.possible_alphas=new Array;if(this.options.colors){for(j=0;j<this.options.colors.length;j++){this.possible_hues.push(this.options.colors[j])}}else{var b=this.options.portion/(this.options.steps-1);for(j=1;j<this.options.steps-1;j++){this.possible_hues.push(b*j*360);this.possible_sats.push(b*j*100);this.possible_lights.push(b*j*100);this.possible_alphas.push(b*j)}this.possible_hues.unshift(0);this.possible_hues.push(this.options.portion*360);this.possible_sats.unshift(0);this.possible_sats.push(this.options.portion*100);this.possible_lights.unshift(0);this.possible_lights.push(this.options.portion*100);this.possible_alphas.unshift(0);this.possible_alphas.push(this.options.portion*100)}}this.children=a(this.element).find(this.options.elementSelector).not(this.options.preventionSelector);for(i=0;i<this.children.length;i++){var c=this.methods.get_number_from_element(this.children[i],this.options.dataAttribute);if(!isNaN(c)&&(this.options.min_val==null||c>this.options.min_val)&&(this.options.max_val==null||c<this.options.max_val)){this.values.push({element:this.children[i],value:c,scaled_val:null});if(c>this.max){this.max=c}if(c<this.min){this.min=c}}}for(i=0;i<this.values.length;i++){var d,e,f,g,h,k,l,m;unscaled_value=this.values[i].value;e=this.values[i].element;f=this.methods.scale_feature(this.options.scale,unscaled_value,this.min,this.max);f=this.options.reverse?1-f:f;h=this.options.hue;k=this.options.colorModel=="grayscale"?0:this.options.saturation;l=this.options.lightness;m=this.options.alpha;for(j=0;j<this.options.mapDataTo.length;j++){switch(this.options.mapDataTo[j]){case"h":h=(f*this.options.portion*360+this.options.offset*360)%360;break;case"s":k=f*100;break;case"l":l=f*100;break;case"a":m=f;break}}if(this.options.stepwise&&this.options.colorModel!="grayscale"){var n=Math.floor(f/(1/this.options.steps));if(n==this.options.steps){n--}for(j=0;j<this.options.mapDataTo.length;j++){switch(this.options.mapDataTo[j]){case"h":h=(this.possible_hues[n]+this.options.offset)%360;break;case"s":k=(this.possible_sats[n]+this.options.offset)%100;break;case"l":l=(this.possible_lights[n]+this.options.offset)%100;break;case"a":m=this.possible_alphas[n]+this.options.offset;break}}}if(this.options.colorModel=="rgb"||this.options.colorModel=="grayscale"){var o;if(this.options.colorModel=="grayscale"){var p;if(this.options.stepwise){p=this.methods.get_shade(this.methods.get_stepwise_value(f,this.options.steps),255)}else{p=this.methods.get_shade(f,255)}o=[p,p,p]}else{o=this.methods.hslToRgb(h,k,l)}g="rgb("+Math.round(o[0])+", "+Math.round(o[1])+", "+Math.round(o[2])+")"}else if(this.options.colorModel=="hsla"){g="hsla("+h+", "+k+"%, "+l+"%, "+m+")"}a(e).addClass(this.options.addedClass).css(this.options.attributeToColor,g)}};a.fn[d]=function(b){return this.each(function(){if(!a.data(this,"plugin_"+d)){a.data(this,"plugin_"+d,new g(this,b))}})}})(jQuery,window,document)